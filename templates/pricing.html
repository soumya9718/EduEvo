<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>EduEvo — Choose Your Plan</title>
<style>
  :root{
    --bg:#050912;
    --panel:#0b1629;
    --panel2:#0f1f38;
    --text:#e7eef9;
    --muted:#94a3b8;
    --brand:#22c55e;
    --brand2:#16a34a;
    --border:rgba(148,163,184,0.2);
  }
  *{box-sizing:border-box;font-family:'Inter',system-ui,sans-serif}
  body{
    min-height:100vh;
    margin:0;
    background:radial-gradient(circle at top,#112240,#040911 55%);
    color:var(--text);
    padding:32px 18px;
  }
  .container{
    max-width:1200px;
    margin:0 auto;
  }
  .header{
    text-align:center;
    margin-bottom:48px;
  }
  .header h1{
    font-size:42px;
    margin:0 0 12px;
    background:linear-gradient(135deg,var(--brand),var(--brand2));
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    background-clip:text;
  }
  .header p{
    color:var(--muted);
    font-size:18px;
    margin:0;
  }
  .pricing-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
    gap:24px;
    margin-bottom:40px;
  }
  .pricing-card{
    background:linear-gradient(145deg,var(--panel),var(--panel2));
    border:1px solid rgba(255,255,255,0.08);
    border-radius:20px;
    padding:32px;
    position:relative;
    transition:transform .2s ease,box-shadow .2s ease;
  }
  .pricing-card:hover{
    transform:translateY(-4px);
    box-shadow:0 20px 40px rgba(0,0,0,0.3);
  }
  .pricing-card.featured{
    border:2px solid #3b82f6;
    box-shadow:0 0 30px rgba(59,130,246,0.3);
  }
  .popular-badge{
    position:absolute;
    top:20px;
    right:20px;
    padding:6px 14px;
    border-radius:999px;
    font-size:12px;
    font-weight:700;
    background:#9333ea;
    color:#fff;
  }
  .plan-name{
    font-size:24px;
    font-weight:700;
    margin:0 0 16px;
    color:var(--text);
  }
  .plan-price{
    font-size:32px;
    font-weight:700;
    margin:0 0 24px;
    display:flex;
    align-items:baseline;
    gap:4px;
    color:var(--text);
  }
  .plan-price .currency{
    font-size:24px;
    color:var(--text);
  }
  .plan-price .period{
    font-size:16px;
    color:var(--muted);
    font-weight:400;
  }
  .plan-features-section{
    margin-top:24px;
  }
  .features-label{
    font-size:14px;
    font-weight:600;
    color:var(--text);
    margin-bottom:12px;
  }
  .plan-features{
    list-style:none;
    padding:0;
    margin:0;
  }
  .plan-features li{
    padding:8px 0;
    color:var(--muted);
    display:flex;
    align-items:flex-start;
    gap:10px;
    font-size:14px;
    line-height:1.5;
  }
  .plan-features li::before{
    content:'✓';
    color:#fff;
    font-weight:700;
    font-size:16px;
    flex-shrink:0;
    margin-top:2px;
  }
  .btn{
    width:100%;
    padding:14px 20px;
    border-radius:8px;
    border:0;
    font-weight:700;
    font-size:15px;
    cursor:pointer;
    transition:transform .2s ease,opacity .2s ease;
    background:#1e40af;
    color:#fff;
    margin-bottom:24px;
  }
  .btn.featured-btn{
    background:#3b82f6;
    color:#fff;
  }
  .btn:active{transform:scale(.98)}
  .btn.secondary{
    background:transparent;
    border:1px solid var(--border);
    color:var(--text);
  }
  .btn:disabled{
    opacity:0.6;
    cursor:not-allowed;
  }
  .coupon-section{
    margin-top:40px;
    padding-top:32px;
    border-top:1px solid var(--border);
    text-align:center;
  }
  .coupon-checkbox{
    display:flex;
    align-items:center;
    justify-content:center;
    gap:10px;
    margin-bottom:16px;
    cursor:pointer;
  }
  .coupon-checkbox input[type="checkbox"]{
    width:18px;
    height:18px;
    cursor:pointer;
  }
  .coupon-input-group{
    display:none;
    gap:10px;
    max-width:400px;
    margin:0 auto;
    align-items:center;
  }
  .coupon-input-group.show{
    display:flex;
  }
  .coupon-input{
    flex:1;
    padding:12px 14px;
    border-radius:10px;
    border:1px solid var(--border);
    background:rgba(4,8,18,0.7);
    color:var(--text);
    font-size:15px;
  }
  .coupon-input:focus{
    outline:none;
    border-color:var(--brand);
  }
  .coupon-btn{
    padding:12px 20px;
    border-radius:10px;
    border:0;
    background:linear-gradient(135deg,var(--brand),var(--brand2));
    color:#041307;
    font-weight:700;
    cursor:pointer;
  }
  .coupon-message{
    margin-top:12px;
    min-height:24px;
    font-size:14px;
  }
  .coupon-message.error{color:#f87171}
  .coupon-message.success{color:#4ade80}
  .back-btn{
    position:absolute;
    top:20px;
    left:20px;
    padding:8px 14px;
    border-radius:8px;
    border:1px solid var(--border);
    background:transparent;
    color:var(--muted);
    text-decoration:none;
    font-size:14px;
    transition:all .2s ease;
  }
  .back-btn:hover{
    border-color:var(--brand);
    color:var(--brand);
  }
</style>
</head>
<body>
  <a href="/" class="back-btn">← Back to site</a>
  <div class="container">
    <div class="header">
      <h1>Choose Your EduEvo Plan</h1>
      <p>Select the perfect plan for your learning journey</p>
    </div>

    <div class="pricing-grid">
      <!-- Plus Plan -->
      <div class="pricing-card">
        <h2 class="plan-name">EduEvo Plus</h2>
        <div class="plan-price">
          <span class="currency">₹</span>
          <span class="amount" data-original="99">99</span>
          <span class="period"> / month</span>
        </div>
        <button class="btn" data-plan="plus" onclick="handlePlanClick('plus')">Get Started Now</button>
        <div class="plan-features-section">
          <div class="features-label">Includes:</div>
          <ul class="plan-features">
            <li>Optional add-ons (Smart remainders and custom themes)</li>
            <li>Increased Personalization</li>
            <li>Offline notes access</li>
            <li>Progress tracker & remainders</li>
            <li>No ads</li>
          </ul>
        </div>
      </div>

      <!-- Max Plan -->
      <div class="pricing-card featured">
        <div class="popular-badge">Popular</div>
        <h2 class="plan-name">EduEvo Max</h2>
        <div class="plan-price">
          <span class="currency">₹</span>
          <span class="amount" data-original="149">149</span>
          <span class="period"> / month</span>
        </div>
        <button class="btn featured-btn" data-plan="max" onclick="handlePlanClick('max')">Get Started Now</button>
        <div class="plan-features-section">
          <div class="features-label">Includes:</div>
          <ul class="plan-features">
            <li>AI-based quizzes & revision test</li>
            <li>Deep analysis & performance reports</li>
            <li>Priority support</li>
            <li>Unlimited Personalization</li>
            <li>Own Study Room access</li>
            <li>Exclusive EduEvo Max tools & early feature access</li>
          </ul>
        </div>
      </div>

      <!-- Free Plan -->
      <div class="pricing-card">
        <h2 class="plan-name">EduEvo</h2>
        <div class="plan-price">
          <span class="currency">₹</span>
          <span class="amount" data-original="0">0</span>
        </div>
        <button class="btn" data-plan="free" onclick="handlePlanClick('free')">Get Started Now</button>
        <div class="plan-features-section">
          <div class="features-label">Includes:</div>
          <ul class="plan-features">
            <li>Core features always free</li>
            <li>Limited personalization</li>
            <li>Online Only</li>
            <li>Linked notes + lecture search</li>
            <li>Light ads (non-intrusive)</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="coupon-section">
      <label class="coupon-checkbox">
        <input type="checkbox" id="couponCheckbox" onchange="toggleCouponInput()">
        <span>Have a coupon code?</span>
      </label>
      <div class="coupon-input-group" id="couponInputGroup">
        <input type="text" class="coupon-input" id="couponInput" placeholder="Enter coupon code" onkeydown="if(event.key==='Enter') applyCoupon()">
        <button class="coupon-btn" onclick="applyCoupon()">Apply</button>
      </div>
      <div class="coupon-message" id="couponMessage"></div>
    </div>
  </div>

<script>
// Check if user is logged in
let isLoggedIn = false;
let couponApplied = false;
const VALID_COUPON = 'EVO100';

// Check authentication status on page load
async function checkAuthStatus() {
  try {
    const res = await fetch('/api/check-auth');
    if (res.ok) {
      const data = await res.json();
      isLoggedIn = !!data.authenticated;
      updateButtonTexts();
    }
  } catch (e) {
    console.error('Auth check failed', e);
  }
}

// Initialize on page load
(async function initPricing() {
  await checkAuthStatus();
})();

// Check auth status when page becomes visible (in case user logged in in another tab)
document.addEventListener('visibilitychange', function() {
  if (!document.hidden) {
    checkAuthStatus();
  }
});

function toggleCouponInput() {
  const checkbox = document.getElementById('couponCheckbox');
  const inputGroup = document.getElementById('couponInputGroup');
  const message = document.getElementById('couponMessage');
  
  if (checkbox.checked) {
    inputGroup.classList.add('show');
    document.getElementById('couponInput').focus();
  } else {
    inputGroup.classList.remove('show');
    message.textContent = '';
    couponApplied = false;
    resetPrices();
    updateButtonTexts();
  }
}

function applyCoupon() {
  const input = document.getElementById('couponInput');
  const code = input.value.trim().toUpperCase();
  const message = document.getElementById('couponMessage');
  
  if (!code) {
    message.textContent = 'Please enter a coupon code';
    message.className = 'coupon-message error';
    return;
  }
  
  if (code === VALID_COUPON) {
    couponApplied = true;
    message.textContent = 'Coupon applied successfully!';
    message.className = 'coupon-message success';
    updatePrices();
    updateButtonTexts();
  } else {
    couponApplied = false;
    message.textContent = 'Invalid coupon code';
    message.className = 'coupon-message error';
    resetPrices();
    updateButtonTexts();
  }
}

function updatePrices() {
  if (!couponApplied) return;
  
  // Update Plus plan
  const plusCard = document.querySelector('[data-plan="plus"]').closest('.pricing-card');
  if (plusCard) {
    const plusAmount = plusCard.querySelector('.amount');
    if (plusAmount) plusAmount.textContent = '0';
  }
  
  // Update Max plan
  const maxCard = document.querySelector('[data-plan="max"]').closest('.pricing-card');
  if (maxCard) {
    const maxAmount = maxCard.querySelector('.amount');
    if (maxAmount) maxAmount.textContent = '0';
  }
}

function resetPrices() {
  // Reset Plus plan
  const plusCard = document.querySelector('[data-plan="plus"]').closest('.pricing-card');
  if (plusCard) {
    const plusAmount = plusCard.querySelector('.amount');
    if (plusAmount && plusAmount.dataset.original) {
      plusAmount.textContent = plusAmount.dataset.original;
    }
  }
  
  // Reset Max plan
  const maxCard = document.querySelector('[data-plan="max"]').closest('.pricing-card');
  if (maxCard) {
    const maxAmount = maxCard.querySelector('.amount');
    if (maxAmount && maxAmount.dataset.original) {
      maxAmount.textContent = maxAmount.dataset.original;
    }
  }
}

function updateButtonTexts() {
  const freeBtn = document.querySelector('[data-plan="free"]');
  const plusBtn = document.querySelector('[data-plan="plus"]');
  const maxBtn = document.querySelector('[data-plan="max"]');
  
  // All plans show "Get Started Now" by default
  const buttonText = 'Get Started Now';
  
  if (freeBtn) freeBtn.textContent = buttonText;
  
  // Plus and Max plans
  if (couponApplied) {
    // If coupon applied, show "Continue" for both
    if (plusBtn) plusBtn.textContent = 'Continue';
    if (maxBtn) maxBtn.textContent = 'Continue';
  } else if (isLoggedIn) {
    // If logged in, show "Pay Now"
    if (plusBtn) plusBtn.textContent = 'Pay Now';
    if (maxBtn) maxBtn.textContent = 'Pay Now';
  } else {
    // If not logged in, show "Get Started Now"
    if (plusBtn) plusBtn.textContent = buttonText;
    if (maxBtn) maxBtn.textContent = buttonText;
  }
}

function handlePlanClick(plan) {
  if (plan === 'free') {
    // Free plan - redirect to app or auth
    if (isLoggedIn) {
      window.location.href = '/app';
    } else {
      window.location.href = '/auth';
    }
    return;
  }
  
  // Plus or Max plan
  if (!isLoggedIn) {
    // Not logged in - redirect to auth with return URL
    sessionStorage.setItem('returnUrl', '/pricing');
    window.location.href = '/auth?return_url=/pricing';
    return;
  }
  
  // Logged in - check if coupon applied
  if (couponApplied) {
    // Coupon applied - set plan and redirect to app
    setUserPlan(plan);
  } else {
    // No coupon - show "Not Available now" message
    alert('Not Available now');
    return;
  }
}

async function setUserPlan(plan) {
  try {
    const res = await fetch('/api/set-plan', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({plan: plan})
    });
    const data = await res.json();
    if (res.ok) {
      window.location.href = '/app';
    } else {
      alert(data.error || 'Failed to set plan');
    }
  } catch (e) {
    console.error('Set plan error', e);
    alert('Failed to set plan');
  }
}
</script>
</body>
</html>

